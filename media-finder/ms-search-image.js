(function($){var h=null;var j=1;function getPhotoUrl(a,b){b=b||"small";var c=a.getAttribute("farm");var d=a.getAttribute("server");var e=a.getAttribute("id");var f=a.getAttribute("secret");var g="s";if("medium"==b){g="m"}return"http://farm"+c+".static.flickr.com/"+d+"/"+e+"_"+f+"_"+g+".jpg"};function getInsertUrl(a){var b=a.getAttribute("title");var c=getPhotoUrl(a,"medium");var d="http://www.flickr.com/photos/"+a.getAttribute("owner");return insertUrl+"&title="+encodeURIComponent(b)+"&url="+encodeURIComponent(c)+"&photostream_url="+d};function largeViewer(e){e.preventDefault();var a=$(this);var b=a.attr("href");$("#large_image").attr("src",b);$("#insert").attr("href",a.parent().find(".insert").attr("href"));$("#search_wrapper").hide();$("#large_image_container").show()};function search(){if(h)h.abort();var f={};f.q=$("#q").val();f.license=$("#license").val();f.orderby=$("#orderby").val();f.page=j;f.action="search_image";f.searchby=$("#searchby").val();h=$.post(ajaxurl,f,function(a){var b=a.getElementsByTagName("photo");var c="";for(var i=0,len=b.length;i<len;++i){var d=getPhotoUrl(b[i],"small");var e=b[i].getAttribute("title");c+='<li class="search-result"><img class="search-result-img" src="'+d+'" alt="'+e+'" title="'+e+'" style="width: 75px; height: 75px;"><div style="text-align: center; margin-top: 0;"><a href="'+getPhotoUrl(b[i],"medium")+'" class="view" >View</a> | <a href="'+getInsertUrl(b[i])+'" class="insert">Insert</a></div></li>'}$("#search_results").html(c);$(".view").bind("click",largeViewer);$(".loading").hide();paging()},"xml")};function paging(){if(j>1){$("#prev_page_wrapper").show()}else{$("#prev_page_wrapper").hide()}$("#next_page_wrapper").show()}$(function(){$("#q").bind("keypress",function(e){if(13==e.keyCode){e.preventDefault();$("#img_search").trigger("click")}});$("#options_link").bind("click",function(e){e.preventDefault();$("#search_options").toggle()});$("#search_options").hide();$("#img_search").bind("click",function(e){e.preventDefault();j=1;$("#form_loading").show();search()});$("#prev_page").bind("click",function(){--j;$("#prev_loading").show();search()});$("#next_page").bind("click",function(){++j;$("#next_loading").show();search()});$("#q").focus();$("#back_search").bind("click",function(e){e.preventDefault();$("#search_wrapper").show();$("#large_image_container").hide();$("#large_image").attr("src","")})})})(jQuery);